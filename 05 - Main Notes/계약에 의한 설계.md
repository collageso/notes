
2024-09-30 23:28

Tags: [[객체지향 프로그래밍]]

- 계약에 의한 설계(Design By Contract, DBC)란?
	- 클라이언트와 서버 사이의 협력을 의무와 이익으로 구성된 계약의 관점에서 표현하는 설계 방법
		- 협력에 참여하는 각 객체는 계약으로부터 이익을 기대하고 이익을 얻기 위해 의무를 이행한다.
		- 협력에 참여하는 각 객체의 이익과 의무는 객체의 인터페이스 상에 문서화된다.
	- 메시지의 이름과 파라미터 목록은 시그니처를 통해 전달할 수 있지만 협력을 위해 필요한 약속과 제약은 인터페이스를 통해 전달할 수 없기 때문에 협력과 관련된 상당한 내용이 암시적이다. 계약을 통해 협력과 그에 따른 부수효과를 명시적으로 표현하자는 것이 계약의 의한 설계의 골자이다.

- 세 가지 요소
	- 사전조건(precondition)
		- 사전조건이란 메서드가 정상적으로 실행되기 위해 만족해야 하는 조건이다.
		- 사전조건을 만족시키는 것은 메서드를 실행하는 클라이언트의 의무다. 따라서 사전조건을 만족시키지 못해서 메서드가 실행되지 않을 경우 클라이언트에 버그가 있다는 것을 의미한다.
		- 일반적으로 사전조건은 메서드에 전달된 인자의 정합성을 체크하기 위해 사용된다.
	- 사후조건(postcondition)
		- 메서드의 실행 결과가 올바른지를 검사하고 실행 후에 객체가 유효한 상태로 남아 있는지를 검증한다.
		- 클라이언트가 사전조건을 만족시켰는데도 서버가 사후조건을 만족시키지 못한다면 서버에 버그가 있음을 의미한다.
		- 일반적으로 사후조건은 다음과 같은 세 가지 용도로 사용된다.
			- 인스턴스 변수의 상태가 올바른지를 서술하기 위해
			- 메서드에 전달된 파라미터의 값이 올바르게 변경됐는지를 서술하기 위해
			- 반환값이 올바른지를 서술하기 위해
		- 다음과 같은 두 가지 이유로 인해 사전조건보다 사후조건을 정의하는 것이 더 어려울 수 있다.
			- 한 메서드 안에서 return 문이 여러 번 나올 경우
			- 실행 전과 실행 후의 값을 비교해야 하는 경우
	- 불변식(invariant)
		- 사전조건과 사후조건은 각 메서드마다 달라지는 데 반해 불변식은 인스턴스 생명주기 전반에 걸쳐 지켜져야 하는 규칙을 명세한다.
		- 불변식은 다음과 같은 두 가지 특성을 가진다.
			- 불변식은 클래스의 모든 인스턴스가 생성된 후에 만족돼야 한다. 이것은 클래스에 정의된 모든 생성자는 불변식을 준수해야 한다는 것을 의미한다.
			- 불변식은 클라이언트에 의해 호출 가능한 모든 메서드에 의해 준수돼야 한다. 메서드가 실행되는 중에는 객체의 상태가 불안정한 상태로 빠질 수 있기 때문에 불변식을 만족시킬 필요는 없지만 메서드 실행 전과 메서드 종료 후에는 항상 불변식을 만족하는 상태가 유지돼야 한다.
		- 불변식은 생성자 실행 후, (모든) 메서드 실행 전, 메서드, 실행 후에 호출돼야 한다.

- 계약에 의한 설계와 서브타이핑
	- 서브타입이 리스코프 치환 원칙을 만족시키기 위해서는 클라이언트와 슈퍼타입 간에 체결된 '계약'을 준수해야 한다. 
	- 리스코프 치환 원칙의 규칙을 두 가지 종류로 세분화할 수 있다.
		- 계약규칙(contract rules)
			- 서브타입에 더 강력한(더 구체적인) 사전조건을 정의할 수 없다.
			- 서브타입에 더 완화된(더 추상적인) 사후조건을 정의할 수 없다.
			- 슈퍼타입의 불변식은 서브타입에서도 반드시 유지돼야 한다.
		- 가변성 규칙(variance rules)
			- 서브타입의 메서드 파라미터는 반공변성을 가져야 한다.
				- 파라미터 타입 반공변성: 부모 클래스에서 구현된 메서드를 자식 클래스에서 오버라이딩할 때 파라미터 타입을 부모 클래스에서 사용한 파라미터의 슈퍼타입으로 지정할 수 있는 특성
			- 서브타입의 리턴 타입은 공변성을 가져야 한다.
				- 리턴 타입 공변성: 부모 클래스에서 구현된 메서드를 자식 클래스에서 오버라이딩 할 때 부모 클래스에서 선언한 반환타입의 서브타입으로 지정할 수 있는 특성
			- 서브타입은 슈퍼타입이 발생시키는 예외와 다른 타입의 예외를 발생시켜서는 안 된다.


